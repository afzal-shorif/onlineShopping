	/*
	*  file script.js
	*  use for ajax request
	*  included in footer
	*  three slash is use for description comment
	*  two slash is use for debug comment
	*/
	(function () {
		/// self calling function
		/// use to get cart products
		/// return in json array

		var xhr = new XMLHttpRequest(); 					/// http request object

		/// request end point
		xhr.open("GET", "saveJsonData.php?session_id="+session_value, true);
		
		//xhr.setRequestHeader('Content-Type', 'application/json');
		/// request header
		xhr.setRequestHeader('X-Requested-With','nothing');
		
		xhr.onreadystatechange = function (){
		
			if(xhr.readyState == 2){
				/// on loading...
			}
			
			if(xhr.readyState == 4 && xhr.status == 200){

				var result = JSON.parse(xhr.responseText); 			/// parse the json data into javascrit array
				//var result = xhr.responseText;
				
					
				if(result['status'] == 'ok'){
					/// request successful
					/// counter is cart icon (product count)
					/// counter1 for mobile view
					/// counter2 for desktop view

					if(counter1 != null){
						counter1.innerHTML = result['product_num'];			/// update the cart value
					}

					if(counter2 != null){
						counter2.innerHTML = result['product_num'];			/// update the cart value
					}

				}else{
					/// request not successful
				}
				//console.table(result);
			}
		}


		xhr.send();				/// send the request


		/// hide (proceed to checkout) button if list is empty in shopping_cart.php
		var checkoutProceed = document.getElementById('checkoutProceed');			/// get the button

		if(checkoutProceed != null){
			/// in shopping-cart page
			checkoutProceed.style.display = 'none';

			/// single_product_price is an array contain all the product price
			/// generated by php... inside foreach loop in...

			if(single_product_price.length>0){
				checkoutProceed.style.display = 'block';
			}
		}

	})();
	
	

	function sentData(jsonData, iconObj){
		/// send a ajax request in saveJsonData.php page
		/// jsonData is a json object
		/// iconObj is status flag in add to cart button
		var xhr = new XMLHttpRequest();			/// initial http request
		xhr.open("POST", "saveJsonData.php", true);		/// open the request

		/// request header
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.setRequestHeader('X-Requested-With','nothing');
		
		xhr.onreadystatechange = function (){
		
			if(xhr.readyState == 2){
				/// request is sent
				/// initially the icon is loading icon
				iconObj.style.display = 'inline-block'; 	/// display the icon in add to cart button
			}
			
			if(xhr.readyState == 4 && xhr.status == 200){
				var result = JSON.parse(xhr.responseText);			/// get the response
				//var result = xhr.responseText;
				
					
				if(result['status'] == 'ok'){
					/// success
					/// update the add to cart button icon
					iconObj.setAttribute('class' , "fa fa-check");
					iconObj.style.color = "green";			/// set the color of icon

					/// update cart icon value
					if(counter1 != null){
						/// for mobile view
						counter1.innerHTML = result['product_num'];
					}
					if(counter2 != null){
						/// for desktop view
						counter2.innerHTML = result['product_num'];
					}
				}else{
					/// fail
					/// update the add to cart icon
					iconObj.setAttribute('class' , "fa fa-remove");
					iconObj.style.color = "red";		/// change the icon color
				}
				//console.table(result);
			}
		}
		
		xhr.send(jsonData);			/// send the request
		
	}
	

	function addToTheList(){
		/// prepare json data to add in cart for ajax request
		var q = 1;			/// initial the number of product
		console.log('arrive');
		/// if in shopping_cart.php page then update the number of product with value in input field
		if(inputField != null){

			if(inputField.value <=0) {
				inputField.value = 1;
				return;
			}
			if(inputField.value > 10) {
				inputField.value = 10;
				return;
			}
			q = inputField.value;
		}
		console.log('return');
		
		/// make javascript array to convert json array
		var data  = {
			user_id: session_value,
			product_id: this.id,
			quantity: q
		};
		/// get the icon object contain inside this button to change the status
		var iconObj = this.childNodes[1];
		var myJson = JSON.stringify(data);			/// convert into json
		sentData(myJson, iconObj);					/// call sentData function for ajax request
	}
	
	/// update total price
	function updateTotalPrice() {
		var subTotal = document.getElementsByClassName('productTotal');
		var total = 0;
		for(var i=0; i<subTotal.length;i++){
			total += parseFloat(subTotal[i].textContent);
		}

		totalPrice.innerHTML = parseFloat(total).toFixed(2);
	}
	
	
	
	function incrementQuantity(){
		/// increment the quantity of the product
		var tmp = this.parentElement.childNodes[3];		/// get the quantity input field
		var id = this.getAttribute("data-product-id"); 	/// get the product_id from custom attribute
		var price = single_product_price[id];							/// get the product price from array
		var subPrice = document.getElementById(id);						/// get the element that contain sub_total (total price for that product),(quantity * single_product_price)

		var v = tmp.value;		
		v++;
		if(v>10) return;			/// return if single product quantity is greater then 10;
		
		var data  = {
			user_id: session_value,
			product_id: id,
			quantity: v
		};
		
		var myJson = JSON.stringify(data);
		
		var xhr = new XMLHttpRequest();
		xhr.open("PUT", "saveJsonData.php", true);
		
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.setRequestHeader('X-Requested-With','nothing');

		xhr.onreadystatechange = function (){
		
			if(xhr.readyState == 2){
				//iconObj.style.display = 'inline-block';
			}
			
			if(xhr.readyState == 4 && xhr.status == 200){
				var result = JSON.parse(xhr.responseText);
				//var result = xhr.responseText;
				
					
				if(result['status'] == 'ok'){
					tmp.value = result['quantity'];
					var p = parseFloat(price);
					subPrice.innerHTML = (p*result['quantity']).toFixed(2);
					updateTotalPrice();
				}
			}
		}
		
		xhr.send(myJson);
	}
	
	
	function decrementQuantity(){
		
		var tmp = this.parentElement.childNodes[3];
		var v = tmp.value;
		var id = this.getAttribute("data-product-id");
		var price = single_product_price[id];
		var subPrice = document.getElementById(id);
		
		v--;
		if(v<=0){
			return;
		}
		var data  = {
			user_id: session_value,
			product_id: id,
			quantity: v
		};
		
		var myJson = JSON.stringify(data);
		
		var xhr = new XMLHttpRequest();
		xhr.open("PUT", "saveJsonData.php", true);
		
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.setRequestHeader('X-Requested-With','nothing');

		xhr.onreadystatechange = function (){
		
			if(xhr.readyState == 2){
				//iconObj.style.display = 'inline-block';
			}
			
			if(xhr.readyState == 4 && xhr.status == 200){
				var result = JSON.parse(xhr.responseText);
				//var result = xhr.responseText;
				
					
				if(result['status'] == 'ok'){
					tmp.value = result['quantity'];
					var p = parseFloat(price);
					subPrice.innerHTML = (p*result['quantity']).toFixed(2);
					updateTotalPrice();
				}
				
				//console.table(result);
			}
		}
		
		xhr.send(myJson);
	}
	
	
	
	var add = document.getElementsByClassName('add');			/// + buttons in shopping_cart.php file
	var sub = document.getElementsByClassName('sub');			/// - buttons in shopping_cart.php file
	var inputField = document.getElementById('quantity_input');	/// input field in shopping_cart.php file to show quantity
	var counter1 = document.getElementById('count1');				/// cart icon for mobile
	var counter2 = document.getElementById('count2');				/// cart icon for desktop
	var totalPrice = document.getElementById('sum');				/// to display total price in shopping_cart.php file
	var allButton = document.getElementsByClassName("list_btn");	/// get the all products button (add to cart)

	/// assign click event listener for products button
	for(var i=0;i<allButton.length;i++){
		allButton[i].addEventListener('click', addToTheList);
	}

	/// assing click event listener for add buttons in shopping_cart.php file
	for(var i=0;i<add.length;i++){
		add[i].addEventListener('click', incrementQuantity);
	}
	/// assing click event listener for sub buttons in shopping_cart.php file
	for(var i=0;i<sub.length;i++){
		sub[i].addEventListener('click', decrementQuantity);
	}
	

	